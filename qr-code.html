<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="">
	<meta name="author" content="">
	<title>GuideMeIn Position</title>
</head>
<body>
	<script src="https://cdn.jsdelivr.net/mobile-detect.js/1.3.5/mobile-detect.js"></script>

	<script>

  // fallback сработает если не откроется установленное приложение
  function openStore(time) {
  	console.log('Opening Site');
  	window.location.href = 'http://guidemein.ru';
  };

  var md = new MobileDetect(window.navigator.userAgent);
  if(md.is('iOS')){
  	var parameters = location.search.substring(1).split("&");
  	var temp = parameters[0].split("=");
  	v_key = unescape(temp[0]);
  	v_id = unescape(temp[1]);

      	var appUrl = `guidemein://position?${v_key}=${v_id}`;
  // Задержка для того чтобы приложение успело открыться
  var openTimeout = setTimeout(openStore(), 300);

  var iframe = document.createElement('iframe');
  iframe.onload = function() {
  	clearTimeout(openTimeout);
  	iframe.parentNode.removeChild(iframe);
  	window.location.href = appUrl;
  };

  iframe.src = appUrl;
  iframe.style.display = 'none';
  console.log('Opening App');
  document.body.appendChild(iframe);
}
else {
	openStore()
}

</script>

</body>
</html>