<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="">
	<meta name="author" content="">
	<title>GuideMeIn Position</title>
</head>
<body>

	<span id="spanId">Text span.</span>


	<script src="https://cdn.jsdelivr.net/mobile-detect.js/1.3.5/mobile-detect.js"></script>

	<script>

		var span = document.getElementById('spanId');
			while( span.firstChild ) {
  		span.removeChild( span.firstChild );
  	}


  // fallback сработает если не откроется установленное приложение
  function openStore(time) {
  	console.log('Opening Site');
  	alert("Opening Site!");
  	window.location.href = 'http://guidemein.ru';
  };

  var md = new MobileDetect(window.navigator.userAgent);

  if(md.is('iOS')){
  	var os = `${md.os()} версии ${md.version('iOS')} на ${md.phone()}`;
  	console.log(`${os}`);



  


  	span.appendChild( document.createTextNode(`${os}`) );




  	var parameters = location.search.substring(1).split("&");
  	var temp = parameters[0].split("=");
  	v_key = unescape(temp[0]);
  	v_id = unescape(temp[1]);

  	var appUrl = `guidemein://position?${v_key}=${v_id}`;
  	span.appendChild( document.createTextNode(` app scheme ${appUrl}`) );

  	console.log(appUrl);
  // Задержка для того чтобы приложение успело открыться
  //var openTimeout = setTimeout(openStore(), 3000);

  var iframe = document.createElement('iframe');
  iframe.onload = function() {
  	clearTimeout(openTimeout);
  	iframe.parentNode.removeChild(iframe);
  	window.location.href = appUrl;
  	span.appendChild( document.createTextNode(` iFrame loaded`) );
  };

  iframe.src = appUrl;
  iframe.style.display = 'none';
  console.log('Opening App');
  document.body.appendChild(iframe);
}
else {
	console.log('Not iOS, open site');
	span.appendChild( document.createTextNode(` Not iOS, open site`) );
	//openStore();
}

span.appendChild( document.createTextNode(` JS works!`) );

</script>


</body>
</html>